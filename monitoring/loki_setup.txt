# Loki Monitoring Setup

## 1. Start Loki and Grafana
Use Docker Compose to start Loki and Grafana. Create a `docker-compose.yml` with the following content:

```yaml
version: "3"
services:
  loki:
    image: grafana/loki:2.9.0
    ports:
      - "3100:3100"
    command: -config.file=/etc/loki/local-config.yaml

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
```

Run:
```bash
docker-compose up -d
```

## 2. Configure Docker to send logs to Loki
Install the Docker Loki driver:
```bash
docker plugin install grafana/loki-docker-driver:latest --alias loki --grant-all-permissions
```

Run your container with the Loki driver:
```bash
docker run --log-driver=loki --log-opt loki-url="http://localhost:3100/loki/api/v1/push" hello-devops
```

## 3. View Logs
You can view logs in Grafana (http://localhost:3000) by adding Loki as a data source (URL: `http://loki:3100`).

Or query via command line using `curl`:
```bash
curl -G -s  "http://localhost:3100/loki/api/v1/query_range" --data-urlencode 'query={container_name="hello-devops"}' | jq
```
